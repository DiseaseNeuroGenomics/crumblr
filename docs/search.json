[{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"installation","dir":"Articles","previous_headings":"","what":"Installation","title":"Using crumblr in practice","text":"install package, start R enter:","code":"if (!require(\"BiocManager\", quietly = TRUE)) {   install.packages(\"BiocManager\") }  # Select release #1 or #2  # 1) Bioconductor release (coming soon...) # BiocManager::install(\"crumblr\")  # 2) Latest stable release devtools::install_github(\"DiseaseNeurogenomics/crumblr\")"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"process-data","dir":"Articles","previous_headings":"Installation","what":"Process data","title":"Using crumblr in practice","text":"evaluate whether observed cell proportions change response interferon β. Given results , reject null hypothesis interferon β affect cell type proportions.","code":"library(crumblr)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Apply crumblr transformation # cobj is an EList object compatable with limma workflow # cobj$E stores transformed values # cobj$weights stores precision weights #    corresponding to the regularized inverse variance cobj <- crumblr( df_cellCounts )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"variance-partitioning","dir":"Articles","previous_headings":"Installation","what":"Variance partitioning","title":"Using crumblr in practice","text":"Decomposing variance illustrates variation explained subject stimulation status.","code":"library(variancePartition)  # Partition variance into components for Subject (i.e. ind) #   and stimulation status, and residual variation form =  ~ (1|ind) + (1|StimStatus) vp <- fitExtractVarPartModel(cobj, form, info)  # Plot variance fractions fig.vp = plotPercentBars(vp) fig.vp"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"pca","dir":"Articles","previous_headings":"Installation","what":"PCA","title":"Using crumblr in practice","text":"Performing PCA transformed cell counts indicates samples cluster based subject rather stimulation status.","code":"library(ggplot2)  # Perform PCA # use crumblr::standardize() to get values with  # approximately equal sampling variance, # which is a key property for downstream PCA and clustering analysis. pca <- prcomp(t(standardize(cobj)))  # merge with metadata df_pca <- merge(pca$x, info, by = \"row.names\")  # Plot PCA #   color by Subject #   shape by Stimulated vs unstimulated ggplot(df_pca, aes(PC1, PC2, color = as.character(ind), shape = StimStatus)) +   geom_point(size = 3) +   theme_classic() +   theme(aspect.ratio = 1) +   scale_color_discrete(name = \"Subject\") +   xlab(\"PC1\") +   ylab(\"PC2\")"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"hierachical-clustering","dir":"Articles","previous_headings":"Installation","what":"Hierachical clustering","title":"Using crumblr in practice","text":"samples subject also cluster together.","code":"heatmap(cobj$E)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"differential-testing","dir":"Articles","previous_headings":"Installation","what":"Differential testing","title":"Using crumblr in practice","text":"","code":"# Use variancePartition workflow to analyze each cell type # Perform regression on each cell type separately #  then use eBayes to shrink residual variance # Also compatible with limma::lmFit() fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Extract results for each cell type topTable(fit, coef = \"StimStatusstim\", number = Inf) ##                         logFC    AveExpr          t     P.Value  adj.P.Val         B ## CD8 T cells       -0.25085170  0.0857175 -4.0787416 0.002436375 0.01949100 -1.279815 ## Dendritic cells    0.37386979 -2.1849234  3.1619195 0.010692544 0.02738587 -2.638507 ## CD14+ Monocytes   -0.10525402  1.2698117 -3.1226341 0.011413912 0.02738587 -2.709377 ## B cells           -0.10478652  0.5516882 -3.0134349 0.013692935 0.02738587 -2.940542 ## CD4 T cells       -0.07840101  2.0201947 -2.2318104 0.050869691 0.08139151 -4.128069 ## FCGR3A+ Monocytes  0.07425165 -0.2567492  1.6647681 0.128337022 0.17111603 -4.935304 ## NK cells           0.10270672  0.3797777  1.5181860 0.161321761 0.18436773 -5.247806 ## Megakaryocytes     0.01377768 -1.8655172  0.1555131 0.879651456 0.87965146 -6.198336"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"multivariate-testing-along-a-tree","dir":"Articles","previous_headings":"Installation > Differential testing","what":"Multivariate testing along a tree","title":"Using crumblr in practice","text":"can gain power jointly testing multiple cell types using multivariate statistical model, instead testing one cell type time. construct hierarchical clustering cell types based gene expression pseudobulk, perform multivariate test internal node tree based leaf nodes. results leaves topTable() . internal node treeTest() performs fixed effects meta-analysis coefficients leaves modeling covariance coefficient estimates. backend, implemented using variancePartition::mvTest() remaCor package.","code":"# Perform multivariate test across the hierarchy res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot hierarchy and testing results plotTreeTest(res) # Plot hierarchy and regression coefficients plotTreeTestBeta(res)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr.html","id":"combined-plotting","dir":"Articles","previous_headings":"Installation > Differential testing > Multivariate testing along a tree","what":"Combined plotting","title":"Using crumblr in practice","text":"","code":"plotTreeTestBeta(res) +    theme(legend.position=\"bottom\", legend.box = \"vertical\") |    plotForest(res, hide=FALSE) |    fig.vp"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_theory.html","id":"asymptotic-normal-approximation","dir":"Articles","previous_headings":"","what":"Asymptotic normal approximation","title":"Normal approximation vs. empirical simulation","text":"Let vector ${\\bf p}$ true fractions across DD categories. Consider CC total counts sampled Dirichlet-multinomial (DMN) distribution overdispersion τ\\tau, τ=1\\tau=1 reduces multinomial distribution. centered log ratio (CLR) ithi^{th} estimated fraction ${\\bf \\hat p}$ $$\\begin{equation} \\tag{1} \\text{clr}_i({\\bf \\hat p}) = \\log(\\hat p_i) - \\frac{1}{D}\\sum_{j=1}^D \\log(\\hat p_j) \\end{equation}$$ show sampling variance $$\\begin{equation} \\tag{2} \\text{var}[\\text{clr}_i({\\bf \\hat p})] =  \\frac{\\tau}{C} \\left[ \\frac{1}{\\hat p_i} - \\frac{2}{ D \\hat p_i} + \\frac{1}{D^2}\\sum_{j=1}^D \\frac{1}{\\hat p_j}  \\right]. \\label{eqn2} \\end{equation}$$","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_theory.html","id":"simulations","dir":"Articles","previous_headings":"","what":"Simulations","title":"Normal approximation vs. empirical simulation","text":"sampling variance derived asymototic theory, examine behavior finite total counts. evalute emprical variance 1,0001,000 draws Dirichlet-multinomial distribution varying DD, τ\\tau, CC. pseudocount 0.5 added observed counts since asymptotic theory defined counts zero. plot standard deviation CLR transform empirical DMN asymptotic normal approximation range conditions. Results shown instances least 2 counts.","code":""},{"path":[]},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_theory.html","id":"interpretation","dir":"Articles","previous_headings":"","what":"Interpretation","title":"Normal approximation vs. empirical simulation","text":"asymptotic standard deviation shows good agreement empirical results even small values CC, least 2 counts observed. practice, often reasonable assume sufficient number counts variable included analysis. Importantly, less 2 counts asymptotic theory gives larger standard deviation emprical results (results shown). Therefore, approach conservative underestimate true amount variation. asymptotic normal approximation accurate large total counts CC, large proportions pp, small overdispersion τ\\tau.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_theory.html","id":"consideration-of-overdispersion","dir":"Articles","previous_headings":"","what":"Consideration of overdispersion","title":"Normal approximation vs. empirical simulation","text":"Based Equation (2), variance CLR-transformed proportions linear function τ\\tau. Importantly, downstream analysis CLR-transformed proportions precision-weighted linear (mixed) model variance stabilizing transform depends relative variances. Since relative variances invariant scale τ\\tau, applications value τ\\tau can set 1 instead estimated data. applications, crumblr can estimate τ\\tau data using crumblr(counts, tau=NULL). calls dmn.mle() estimate parameters DMN distribution substantially faster alternatives.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_treeTest.html","id":"load-and-process-single-cell-data","dir":"Articles","previous_headings":"","what":"Load and process single cell data","title":"Multivariate testing along a tree","text":"perform analysis PBMCs 8 individuals stimulated interferon-β Kang, et al, 2018, Nature Biotech. perform standard processing dreamlet compute pseudobulk applying crumblr.","code":"library(dreamlet) library(muscat) library(ExperimentHub) library(scater)  # Download data, specifying EH2259 for the Kang, et al study eh <- ExperimentHub() sce <- eh[[\"EH2259\"]]  # only keep singlet cells with sufficient reads sce <- sce[rowSums(counts(sce) > 0) > 0, ] sce <- sce[, colData(sce)$multiplets == \"singlet\"]  # compute QC metrics qc <- perCellQCMetrics(sce)  # remove cells with few or many detected genes ol <- isOutlier(metric = qc$detected, nmads = 2, log = TRUE) sce <- sce[, !ol]  # set variable indicating stimulated (stim) or control (ctrl) sce$StimStatus <- sce$stim  # Since 'ind' is the individual and 'StimStatus' is the stimulus status, # create unique identifier for each sample sce$id <- paste0(sce$StimStatus, sce$ind)  # Create pseudobulk data by specifying cluster_id and sample_id # Count data for each cell type is then stored in the `assay` field # assay: entry in assayNames(sce) storing raw counts # cluster_id: variable in colData(sce) indicating cell clusters # sample_id: variable in colData(sce) indicating sample id for aggregating cells pb <- aggregateToPseudoBulk(sce,   assay = \"counts\",   cluster_id = \"cell\",   sample_id = \"id\",   verbose = FALSE )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_treeTest.html","id":"standard-crumblr-analysis","dir":"Articles","previous_headings":"","what":"Standard crumblr analysis","title":"Multivariate testing along a tree","text":"Apply standard crumblr analysis transform data apply linear (mixed) model, followed empirical Bayes moderated statistics.","code":"library(crumblr)  # crumblr transformation using # cellCounts() to extract counts from pseudobulk cobj <- crumblr(cellCounts(pb))  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, colData(pb)) fit <- eBayes(fit)  # extract top results topTable(fit, coef = \"StimStatusstim\") ##                         logFC    AveExpr          t   P.Value adj.P.Val         B ## Dendritic cells    0.32516900 -2.1849234  1.0895217 0.2923251  0.823424 -4.590653 ## CD14+ Monocytes   -0.12437220  1.2698117 -0.9560159 0.3535191  0.823424 -4.685558 ## B cells           -0.09825871  0.5516882 -0.6779201 0.5076669  0.823424 -4.746255 ## NK cells           0.08494553  0.3797777  0.5814645 0.5691622  0.823424 -4.753355 ## CD4 T cells       -0.07763160  2.0201947 -0.4732415 0.6425378  0.823424 -4.900413 ## CD8 T cells       -0.16431725  0.0857175 -0.3892080 0.7023377  0.823424 -4.758201 ## FCGR3A+ Monocytes  0.06580754 -0.2567492  0.3460969 0.7338531  0.823424 -4.734622 ## Megakaryocytes     0.04681137 -1.8655172  0.2268978 0.8234240  0.823424 -4.635391"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/crumblr_treeTest.html","id":"multivariate-testing-along-a-tree","dir":"Articles","previous_headings":"","what":"Multivariate testing along a tree","title":"Multivariate testing along a tree","text":"can gain power jointly testing multiple cell types using multivariate statistical model, instead testing one cell type time. construct hierarchical clustering cell types based gene expression pseudobulk, perform multivariate test internal node tree based leaf nodes. results leaves topTable() . internal node treeTest() performs fixed effects meta-analysis coefficients leaves modeling covariance coefficient estimates. backend, implemented using variancePartition::mvTest() remaCor package.  example, result passes multiple testing cutoff.","code":"# Hierarchical clustering of cell types # The tree is based on similarity between cell types # based on gene expression hcl <- buildClusterTreeFromPB(pb)  # Perform multivariate test across the hierarchy # Specify coefficient to test res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot hierarchy and testing results # Adjust xlim() until text fits in window plotTreeTest(res) + xlim(0, 7)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/integration.html","id":"load-and-process-single-cell-data","dir":"Articles","previous_headings":"","what":"Load and process single cell data","title":"Integration with dreamlet / SingleCellExperiment","text":"perform analysis PBMCs 8 individuals stimulated interferon-β Kang, et al, 2018, Nature Biotech. perform standard processing dreamlet compute pseudobulk applying crumblr. , single cell RNA-seq data downloaded ExperimentHub.","code":"library(dreamlet) library(muscat) library(ExperimentHub) library(zenith) library(scater)  # Download data, specifying EH2259 for the Kang, et al study eh <- ExperimentHub() sce <- eh[[\"EH2259\"]]  sce$ind = as.character(sce$ind)  # only keep singlet cells with sufficient reads sce <- sce[rowSums(counts(sce) > 0) > 0, ] sce <- sce[, colData(sce)$multiplets == \"singlet\"]  # compute QC metrics qc <- perCellQCMetrics(sce)  # remove cells with few or many detected genes ol <- isOutlier(metric = qc$detected, nmads = 2, log = TRUE) sce <- sce[, !ol]  # set variable indicating stimulated (stim) or control (ctrl) sce$StimStatus <- sce$stim"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/integration.html","id":"aggregate-to-pseudobulk","dir":"Articles","previous_headings":"Load and process single cell data","what":"Aggregate to pseudobulk","title":"Integration with dreamlet / SingleCellExperiment","text":"Dreamlet creates pseudobulk dataset:","code":"# Since 'ind' is the individual and 'StimStatus' is the stimulus status, # create unique identifier for each sample sce$id <- paste0(sce$StimStatus, sce$ind)  # Create pseudobulk data by specifying cluster_id and sample_id for aggregating cells pb <- aggregateToPseudoBulk(sce,   assay = \"counts\",   cluster_id = \"cell\",   sample_id = \"id\",   verbose = FALSE)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/integration.html","id":"process-data","dir":"Articles","previous_headings":"Load and process single cell data","what":"Process data","title":"Integration with dreamlet / SingleCellExperiment","text":"evaluate whether observed cell proportions change response interferon-β.","code":"library(crumblr)  # use dreamlet::cellCounts() to extract data cellCounts(pb)[1:3,1:3] ##          B cells CD14+ Monocytes CD4 T cells ## ctrl101      101             136         288 ## ctrl1015     424             644         819 ## ctrl1016     119             315         413 # Apply crumblr transformation # cobj is an EList object compatable with limma workflow # cobj$E stores transformed values # cobj$weights stores precision weights cobj <- crumblr(cellCounts(pb))"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/integration.html","id":"analysis","dir":"Articles","previous_headings":"Load and process single cell data","what":"Analysis","title":"Integration with dreamlet / SingleCellExperiment","text":"Now continue downstream analysis Given results , see CD8 T cells others change relative abundance following treatment iterferon-β.","code":"library(variancePartition)  fit <- dream(cobj, ~ StimStatus + ind, colData(pb)) fit <- eBayes(fit)  topTable(fit, coef = \"StimStatusstim\", number = Inf) ##                         logFC    AveExpr          t     P.Value  adj.P.Val         B ## CD8 T cells       -0.25085170  0.0857175 -4.0787416 0.002436375 0.01949100 -1.279815 ## Dendritic cells    0.37386979 -2.1849234  3.1619195 0.010692544 0.02738587 -2.638507 ## CD14+ Monocytes   -0.10525402  1.2698117 -3.1226341 0.011413912 0.02738587 -2.709377 ## B cells           -0.10478652  0.5516882 -3.0134349 0.013692935 0.02738587 -2.940542 ## CD4 T cells       -0.07840101  2.0201947 -2.2318104 0.050869691 0.08139151 -4.128069 ## FCGR3A+ Monocytes  0.07425165 -0.2567492  1.6647681 0.128337022 0.17111603 -4.935304 ## NK cells           0.10270672  0.3797777  1.5181860 0.161321761 0.18436773 -5.247806 ## Megakaryocytes     0.01377768 -1.8655172  0.1555131 0.879651456 0.87965146 -6.198336"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/studentize.html","id":"examine-vst","dir":"Articles","previous_headings":"","what":"Examine VST","title":"Student transform","text":"First, simulate count data:","code":"library(crumblr) library(cowplot)  set.seed(1)  # set probability of each category x = rgamma(300, 1, 10) prob = x / sum(x)  # number of samples n_samples = 500  # number of counts nCounts = 3000  # simulate counts from multinomial counts = t(rmultinom(n_samples, size = nCounts, prob = prob)) colnames(counts) = paste0(\"cat_\", 1:length(prob)) rownames(counts) = paste0(\"sample_\", 1:n_samples)  # keep categories with at least 5 counts in at least 10 samples keep = colSums(counts > 5) > 20  # compute fractions from counts # using pseudocount of 0.5 fractions = apply(counts[,keep], 1, function(x){   x = x + 0.5   x / sum(x) })  # run crumblr on counts cobj = crumblr(counts[,keep], tau=1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/studentize.html","id":"apply-vst","dir":"Articles","previous_headings":"","what":"Apply vst","title":"Student transform","text":"crumblr performs centered log-ratio (CLR) transform, computes observation-level precision weights. VST scales transformed values using precision weights. see vst() almost linear sufficiently large CLR values.","code":"df_vst = studentize(cobj)  plotScatterDensity(cobj$E[,1], df_vst[,1]) +          geom_abline(color=\"red\", size=.3) +          ggtitle(\"crumblr + vst transform\") +         xlab(\"CLR\") +         ylab(\"crumblr + studentize\")"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/studentize.html","id":"concordance-between-samples-for-each-transform","dir":"Articles","previous_headings":"","what":"Concordance between samples for each transform","title":"Student transform","text":"Concordance two identically distributed samples show using () fractions, (B) CLR (C) VST proposed . low counts, CLR (B) highly discordant two samples due imprecise measurement. (C) VST -weights measurements improve concordance.","code":"fig1 = plotScatterDensity(fractions[,1], fractions[,2]) +              geom_abline(color=\"red\", size=.3) +              ggtitle(\"Fractions\") +             xlab(\"Sample 1\") +             ylab(\"Sample 2\")   fig2 = plotScatterDensity(cobj$E[,1], cobj$E[,2]) +              geom_abline(color=\"red\", size=.3) +              ggtitle(\"CLR\") +             xlab(\"Sample 1\") +             ylab(\"Sample 2\")  fig3 = plotScatterDensity(df_vst[,1], df_vst[,2]) +              geom_abline(color=\"red\", size=.3) +              ggtitle(\"crumblr + studentize\")  +             xlab(\"Sample 1\") +             ylab(\"Sample 2\")   plot_grid(fig1, fig2, fig3, labels=LETTERS[1:3], nrow=1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/articles/studentize.html","id":"measuring-variance-stabilization","dir":"Articles","previous_headings":"","what":"Measuring variance stabilization","title":"Student transform","text":"variance stabilizing property can observed empirically. feature (.e. gene, cell type, etc), standard deviation transformed value compared rank mean. variance stabilized coefficient variation (.e. sd/mean) smaller. CLR-transform provide variance stabilization compared using fractions, VST produces much stronger stabilization.","code":"# Mean vs SD plot  fig1 = meanSdPlot(fractions) + ggtitle(\"Fractions\")  fig2 = meanSdPlot(cobj$E) + ggtitle(\"CLR\")  fig3 = meanSdPlot(df_vst) + ggtitle(\"crumblr vst\")  plot_grid(fig1, fig2, fig3, labels=LETTERS[1:3], nrow=1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Gabriel Hoffman. Author, maintainer.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Hoffman G (2025). crumblr: Count ratio uncertainty modeling base linear regression. R package version 0.99.13, https://DiseaseNeurogenomics.github.io/crumblr.","code":"@Manual{,   title = {crumblr: Count ratio uncertainty modeling base linear regression},   author = {Gabriel Hoffman},   year = {2025},   note = {R package version 0.99.13},   url = {https://DiseaseNeurogenomics.github.io/crumblr}, }"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/index.html","id":"count-ratio-uncertainty-modeling-based-linear-regression","dir":"","previous_headings":"","what":"Count ratio uncertainty modeling based linear regression","title":"Count ratio uncertainty modeling base linear regression","text":"crumblr package enables analysis count ratio data using precision-weighted linear (mixed) models, PCA clustering. crumblr’s fast, normal approximation transformed count data Dirichlet-multinomial model allows use standard workflows analyize count ratio data modeling heteroskedasticity.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/index.html","id":"details","dir":"","previous_headings":"","what":"Details","title":"Count ratio uncertainty modeling base linear regression","text":"Analysis count ratio data (.e. fractions) requires special consideration since data non-normal, heteroskedastic, spans low rank space. counts can considered directly using Poisson, negative binomial, Dirichlet-multinomial models simple regression applications, can problematic since 1) can computationally expensive, 2) can produce poorly calibrated hypothesis tests, 3) challenging extend applications. widely used centered log-ratio (CLR) transform compositional data analysis makes count ratio data normal enables use linear models, standard methods. Yet CLR-transformed data still highly heteroskedastic: precision measurements varies widely. important factor considered existing methods. crumblr uses fast asymptotic normal approximation CLR-transformed counts Dirichlet-multinomial distribution model sampling variance transformed counts. crumblr enables incorporating sampling variance precision weights linear (mixed) models order increase power control false positive rate. crumblr also uses variance stabilizing transform (vst) based precision weights improve performance PCA clustering.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/index.html","id":"install","dir":"","previous_headings":"","what":"Install","title":"Count ratio uncertainty modeling base linear regression","text":"","code":"# 1) Make sure Bioconductor is installed # 2) Install crumblr and dependencies: devtools::install_github(\"DiseaseNeurogenomics/crumblr\")"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/index.html","id":"introduction-to-compositional-data-analysis","dir":"","previous_headings":"","what":"Introduction to compositional data analysis","title":"Count ratio uncertainty modeling base linear regression","text":"Brief intro bioinformatics Quinn, et al. 2018 Book analysis R van den Boogaart Tolosana-Delgado, 2013","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/IFNCellCounts.html","id":null,"dir":"Reference","previous_headings":"","what":"Cell counts following interferon treatment — IFNCellCounts","title":"Cell counts following interferon treatment — IFNCellCounts","text":"Counts single cell RNA-seq data treated untreated samples kang2018multiplexedcrumblr.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/IFNCellCounts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cell counts following interferon treatment — IFNCellCounts","text":"","code":"data(IFNCellCounts)  info  df_cellCounts  hcl"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/IFNCellCounts.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Cell counts following interferon treatment — IFNCellCounts","text":"info metadata sample df_cellCounts data.frame counts sample hcl cluster cell types based pseudobulk expression object class data.frame 16 rows 4 columns. object class matrix (inherits array) 16 rows 8 columns. object class hclust length 7.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/IFNCellCounts.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Cell counts following interferon treatment — IFNCellCounts","text":"kang2018multiplexedcrumblr","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/buildClusterTree.html","id":null,"dir":"Reference","previous_headings":"","what":"Perform hierarchical clustering on reducedDim — buildClusterTree","title":"Perform hierarchical clustering on reducedDim — buildClusterTree","text":"Perform hierarchical clustering dimension reduction single cell expression data","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/buildClusterTree.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Perform hierarchical clustering on reducedDim — buildClusterTree","text":"","code":"buildClusterTree(   sce,   reduction,   labelCol,   method.dist = c(\"cosine\", \"euclidean\", \"maximum\", \"manhattan\", \"canberra\", \"binary\",     \"minkowski\"),   method.hclust = c(\"complete\", \"ward.D\", \"ward.D2\") )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/buildClusterTree.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Perform hierarchical clustering on reducedDim — buildClusterTree","text":"sce SingleCellExperiment object reduction field reducedDims(sce) use labelCol column SingleCellExperiment storing cell type annotations method.dist method dist(..,method=method.dist) method.hclust method hclust(..,method=method.hclust)","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":null,"dir":"Reference","previous_headings":"","what":"Centered log ratio transform — clr","title":"Centered log ratio transform — clr","text":"Compute centered log ratio (CLR) transform count matrix.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Centered log ratio transform — clr","text":"","code":"clr(counts, pseudocount = 0.5)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Centered log ratio transform — clr","text":"counts count data samples rows variables columns pseudocount added counts avoid issues zeros","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Centered log ratio transform — clr","text":"matrix CLR transformed counts","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Centered log ratio transform — clr","text":"CLR vector x counts D categories defined clr(x) = log(x) - mean(log(x)). details see van den Boogaart  Tolosana-Delgado (2013).","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Centered log ratio transform — clr","text":"van2013analyzingcrumblr","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/clr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Centered log ratio transform — clr","text":"","code":"# set probability of each category prob <- c(0.1, 0.2, 0.3, 0.5)  # number of total counts countsTotal <- 300  # number of samples n_samples <- 100  # simulate info for each sample info <- data.frame(Age = rgamma(n_samples, 50, 1)) rownames(info) <- paste0(\"sample_\", 1:n_samples)  # simulate counts from multinomial counts <- t(rmultinom(n_samples, size = n_samples, prob = prob)) colnames(counts) <- paste0(\"cat_\", 1:length(prob)) rownames(counts) <- paste0(\"sample_\", 1:n_samples)  # centered log ratio clr(counts)[1:4, ] #>               cat_1       cat_2      cat_3     cat_4 #> sample_1 -0.8080212 -0.31847293 0.32507731 0.8014168 #> sample_2 -0.9426299 -0.01464310 0.26720806 0.6900649 #> sample_3 -0.9427424  0.15586990 0.07419186 0.7126806 #> sample_4 -1.2667081  0.04896869 0.26722226 0.9505171"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":null,"dir":"Reference","previous_headings":"","what":"Count ratio uncertainty modeling based linear regression — crumblr","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"Count ratio uncertainty modeling based linear regression (crumblr) returns CLR-transformed counts observation-level inverse-variance weights use weighted linear models.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"","code":"crumblr(   counts,   pseudocount = 0.5,   method = c(\"clr\", \"clr_2class\"),   tau = 1,   max.ratio = 5,   quant = 0.05 )  # S4 method for class 'matrix' crumblr(   counts,   pseudocount = 0.5,   method = c(\"clr\", \"clr_2class\"),   tau = 1,   max.ratio = 5,   quant = 0.05 )  # S4 method for class 'data.frame' crumblr(   counts,   pseudocount = 0.5,   method = c(\"clr\", \"clr_2class\"),   tau = 1,   max.ratio = 5,   quant = 0.05 )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"counts count data samples rows variables columns pseudocount added counts avoid issues zeros method \"clr\" computes standard centered log ratio precision weights based delta approximation. \"clr_2class\" computes clr() transform category using 2 classes: 1) counts category , 2) counts _not_ category . tau overdispersion parameter Dirichlet multinomial.  NULL, estimate observed counts. max.ratio regularize estimates weights maximum ratio max.ratio maximum quant quantile value quant quantile value used max.ratio","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"EList object following components: E: numeric matrix CLR transformed counts weights: numeric matrix observation-level inverse-variance weights","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"Evalute centered log ratio (CLR) transform count matrix, asymptotic theoretical variances transformed observation.  asymptotic normal approximation increasingly accurate small overdispersion \\(\\tau\\), large total counts \\(C\\), large proportions \\(p\\), shows good agreement empirical results situtations. practice, often reasonable assume sufficient number counts variable included analysis anyway.  feasability assumption user determine. Given array p storing proportions one sample across categories, delta approximation uses term 1/p.  can unstable small values p, estimated variances can sensitive small changes proprtions.  address , \"clr_2class\" method computes clr() transform category using 2 classes: 1) counts category , 2) counts _not_ category . Since class (2) now sums counts across categories, small proportions avoided variance estimates stable. real data, asymptotic variance formula can give weights vary substantially across samples give high weights subset samples.  order address , regularize weights reduce variation weights maximum ratio max.ratio maximum quant quantile value.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/crumblr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Count ratio uncertainty modeling based linear regression — crumblr","text":"","code":"# set probability of each category prob <- c(0.1, 0.2, 0.3, 0.5)  # number of total counts countsTotal <- 300  # number of samples n_samples <- 100  # simulate info for each sample info <- data.frame(Age = rgamma(n_samples, 50, 1)) rownames(info) <- paste0(\"sample_\", 1:n_samples)  # simulate counts from multinomial counts <- t(rmultinom(n_samples, size = countsTotal, prob = prob)) colnames(counts) <- paste0(\"cat_\", 1:length(prob)) rownames(counts) <- paste0(\"sample_\", 1:n_samples)  # run crumblr on counts cobj <- crumblr(counts)  # run standard variancePartition analysis on crumblr results library(variancePartition) #> Loading required package: limma #> Loading required package: BiocParallel #>  #> Attaching package: ‘variancePartition’ #> The following object is masked from ‘package:limma’: #>  #>     topTable  fit <- dream(cobj, ~Age, info) fit <- eBayes(fit)  topTable(fit, coef = \"Age\", sort.by = \"none\") #>               logFC    AveExpr          t   P.Value adj.P.Val         B #> cat_1 -0.0005477589 -0.8566924 -0.2637090 0.7925229 0.8449837 -8.860497 #> cat_2  0.0010873618 -0.1446856  0.6497158 0.5172998 0.8449837 -8.625395 #> cat_3 -0.0005053861  0.2350211 -0.3532166 0.7246368 0.8449837 -8.747617 #> cat_4  0.0002294497  0.7663569  0.1960085 0.8449837 0.8449837 -8.770189"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/diffTree.html","id":null,"dir":"Reference","previous_headings":"","what":"Compare difference in estimates between two trees — diffTree","title":"Compare difference in estimates between two trees — diffTree","text":"Compare difference cofficient estimates two trees.  node , test evaluates tree1[] - tree2[] = 0.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/diffTree.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compare difference in estimates between two trees — diffTree","text":"","code":"diffTree(tree1, tree2)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/diffTree.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compare difference in estimates between two trees — diffTree","text":"tree1 object type treedata treeTest() tree2 object type treedata treeTest()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/diffTree.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compare difference in estimates between two trees — diffTree","text":"fixed effect test performed node using treeTest() method = \"FE.empirical\" method = \"FE\", coefficient estimate standard error estimated node based children.  function performs two-sample z-test test given coefficient tree1 significantly different corresponding coefficient tree2.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/diffTree.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compare difference in estimates between two trees — diffTree","text":"","code":"library(variancePartition)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Simulate a factor with 2 levels called DiseaseRand set.seed(123) info$DiseaseRand = sample(LETTERS[seq(2)], nrow(info), replace=TRUE) info$DiseaseRand = factor(info$DiseaseRand, LETTERS[seq(2)])  # Apply crumblr transformation cobj <- crumblr(df_cellCounts)  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Perform multivariate test across the hierarchy res1 <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Perform same test, but on DiseaseRand fit2 <- dream(cobj, ~ DiseaseRand, info) fit2 <- eBayes(fit2) res2 <- treeTest(fit2, cobj, hcl, coef = \"DiseaseRandB\")  # Compare the coefficient estimates at each node # Test if res1 - res2 is significantly different from zero resDiff = diffTree(res1, res2)  resDiff #> 'treedata' S4 object'. #>  #> ...@ phylo: #>  #> Phylogenetic tree with 8 tips and 7 internal nodes. #>  #> Tip labels: #>   B cells, CD14+ Monocytes, CD4 T cells, CD8 T cells, Dendritic cells, FCGR3A+ #> Monocytes, ... #> Node labels: #>   B cells/CD14+ Monocytes/CD4 T cells/CD8 T cells/Dendritic cells/FCGR3A+ #> Monocytes/Megakaryocytes/NK cells, B cells/CD4 T cells/CD8 T #> cells/Megakaryocytes/NK cells, CD14+ Monocytes/Dendritic cells/FCGR3A+ #> Monocytes, CD14+ Monocytes/FCGR3A+ Monocytes, B cells/CD4 T cells/CD8 T #> cells/NK cells, CD4 T cells/CD8 T cells/NK cells, ... #>  #> Rooted; includes branch length(s). #>  #> with the following features available: #>   'beta', 'se', 'stat', 'pvalue', 'n_features', 'lambda', 'method', 'FDR'. #>  #> # The associated data tibble abstraction: 15 × 11 #> # The 'node', 'label' and 'isTip' are from the phylo tree. #>     node label      isTip    beta     se   stat  pvalue n_features lambda method #>    <int> <chr>      <lgl>   <dbl>  <dbl>  <dbl>   <dbl>      <dbl>  <dbl> <chr>  #>  1     1 B cells    TRUE   0.0625 0.151   0.414 6.79e-1          1   0.01 FE.em… #>  2     2 CD14+ Mon… TRUE  -0.0493 0.152  -0.324 7.46e-1          1   0.01 FE.em… #>  3     3 CD4 T cel… TRUE  -0.327  0.208  -1.57  1.16e-1          1   0.01 FE.em… #>  4     4 CD8 T cel… TRUE  -0.229  0.372  -0.615 5.38e-1          1   0.01 FE.em… #>  5     5 Dendritic… TRUE   0.367  0.281   1.30  1.93e-1          1   0.01 FE.em… #>  6     6 FCGR3A+ M… TRUE   0.528  0.181   2.92  3.45e-3          1   0.01 FE.em… #>  7     7 Megakaryo… TRUE  -0.152  0.191  -0.798 4.25e-1          1   0.01 FE.em… #>  8     8 NK cells   TRUE  -0.0955 0.157  -0.606 5.44e-1          1   0.01 FE.em… #>  9     9 B cells/C… FALSE -0.0459 0.0242 -1.90  5.74e-2          8   0.01 FE.em… #> 10    10 B cells/C… FALSE -0.197  0.0520 -3.79  1.51e-4          5   0.01 FE.em… #> # ℹ 5 more rows #> # ℹ 1 more variable: FDR <dbl>  plotTreeTest(resDiff)   plotTreeTestBeta(resDiff)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":null,"dir":"Reference","previous_headings":"","what":"MLE for Dirichlet Multinomial — dmn.mle","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"MLE Dirichlet Multinomial","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"","code":"dmn.mle(counts, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"counts matrix rows samples columns categories ... additional arguments passed optim()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"list storing alpha parameter estimates, logLik, details convergence alpha estimated \\(alpha\\) parameters overdispersion Overdispersion value \\(1 + \\rho^2(n-1)\\) compared multinomial logLik value function scale scaling \\(\\alpha\\) parameters computed second optimization step evals number function evaluations step 1 convergence convergence details step 1","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"Maximize Dirichlet Multinomial (DMN) log-likelihood optim() using log likelihood function gradient.  method uses second round optimization estimate scale \\(\\alpha\\) parameters, necessary accurate estimation overdispersion metric. covariance counts category DMN distributed data \\(n(diag(p) - pp^T) (1 + \\rho^2(n-1))\\) \\(n\\) total counts, vector proportions  \\(p\\), \\(\\rho^2 = 1 / (a_0 + 1)\\) \\(a_0 = \\sum_i \\alpha_i\\).  count data overdispersed factor \\(1 + \\rho^2(n-1)\\) compared multinomial (MN) distribution.  \\(a_0\\) increases, DMN converges MN. See https://en.wikipedia.org/wiki/Dirichlet-multinomial_distribution#Matrix_notation","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/dmn.mle.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"MLE for Dirichlet Multinomial — dmn.mle","text":"","code":"library(HMP) #> Loading required package: dirmult #>  #> Attaching package: ‘HMP’ #> The following object is masked from ‘package:dirmult’: #>  #>     weirMoM  set.seed(1)  n_samples <- 1000 n_counts <- 5000 alpha <- c(500, 1000, 2000)  # Dirichlet.multinomial counts <- Dirichlet.multinomial(rep(n_counts, n_samples), alpha)  fit <- dmn.mle(counts)  fit #> $alpha #>    Taxa 1    Taxa 2    Taxa 3  #>  506.3946 1015.2996 2027.6421  #>  #> $overdispersion #> [1] 2.408036 #>  #> $logLik #> [1] -4777957 #>  #> $scale #> [1] 0.7098813 #>  #> $evals #> function gradient  #>        2        2  #>  #> $convergence #> [1] 0 #>   # overdispersion: true value a0 <- sum(alpha) rhoSq <- 1 / (a0 + 1) 1 + rhoSq * (n_counts - 1) #> [1] 2.427878  # multinomial, so overdispersion is 1 counts <- t(rmultinom(n_samples, n_counts, prob = alpha / sum(alpha)))  dmn.mle(counts) #> $alpha #> [1] 2165173253 4324433613 8651164924 #>  #> $overdispersion #> [1] 1 #>  #> $logLik #> [1] -4779160 #>  #> $scale #> [1] 70011.04 #>  #> $evals #> function gradient  #>       33       33  #>  #> $convergence #> [1] 0 #>  #"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot row standard deviations versus rank of row means — meanSdPlot","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"Diagnositic plot homoscedasticity across variables","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"","code":"meanSdPlot(x)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"x data matrix","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"plot ggplot2","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"Plot sd versus rank mean row like vsn::meanSdPlot.  Also show coefficient variation variances.  lower value indicates stronger variance stabilization","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/meanSdPlot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot row standard deviations versus rank of row means — meanSdPlot","text":"","code":"# set probability of each category prob <- runif(300)  # number of samples n_samples <- 1000  # number of counts nCounts <- 3000  # simulate counts from multinomial counts <- t(rmultinom(n_samples, size = nCounts, prob = prob)) colnames(counts) <- paste0(\"cat_\", 1:length(prob)) rownames(counts) <- paste0(\"sample_\", 1:n_samples)  # keep categories with at least 5 counts in at least 10 samples keep <- colSums(counts > 5) > 10  # run crumblr on counts cobj <- crumblr(counts[, keep], max.ratio=10)  # Plot for CLR # For each sample, plot rank of mean vs sd fig1 = meanSdPlot(cobj$E) + ggtitle(\"CLR\")  # run crumblr::standardize() df_std <- standardize(cobj)  # Standardized crumblr  fig2 = meanSdPlot(df_std) + ggtitle(\"Standardized crumblr\")  # Standardizing the crumblr results better stabilizes # the variances across variables fig1 | fig2"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Forest plot — plotForest","title":"Forest plot — plotForest","text":"Forest plot Forest plot effect size estimates leaves tree","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Forest plot — plotForest","text":"","code":"plotForest(x, ...)  # S4 method for class 'treedata' plotForest(x, ..., hide = FALSE)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Forest plot — plotForest","text":"x result treeTest() ... arguments hide hide rownames legend","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Forest plot — plotForest","text":"","code":"library(variancePartition)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Apply crumblr transformation cobj <- crumblr(df_cellCounts)  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Perform multivariate test across the hierarchy res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot log fold changes from coef plotForest(res)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-treedata-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Forest plot — plotForest,treedata-method","title":"Forest plot — plotForest,treedata-method","text":"Forest plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-treedata-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Forest plot — plotForest,treedata-method","text":"","code":"# S4 method for treedata plotForest(x, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotForest-treedata-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Forest plot — plotForest,treedata-method","text":"x result treeTest() ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotScatterDensity.html","id":null,"dir":"Reference","previous_headings":"","what":"Scatter plot with 2D density using viridis colors — plotScatterDensity","title":"Scatter plot with 2D density using viridis colors — plotScatterDensity","text":"Scatter plot 2D density using viridis colors","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotScatterDensity.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Scatter plot with 2D density using viridis colors — plotScatterDensity","text":"","code":"plotScatterDensity(x, y, size = 1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotScatterDensity.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Scatter plot with 2D density using viridis colors — plotScatterDensity","text":"x x-coordinates points plot y y-coordinates points plot size size point","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotScatterDensity.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Scatter plot with 2D density using viridis colors — plotScatterDensity","text":"plot ggplot2","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotScatterDensity.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Scatter plot with 2D density using viridis colors — plotScatterDensity","text":"","code":"# simulate data M <- Rfast::rmvnorm(1000, mu = c(0, 0), sigma = diag(1, 2))  # create 2D density plot plotScatterDensity(M[, 1], M[, 2])"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTest.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot tree with results from multivariate testing — plotTreeTest","title":"Plot tree with results from multivariate testing — plotTreeTest","text":"Plot tree results multivariate testing","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTest.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot tree with results from multivariate testing — plotTreeTest","text":"","code":"plotTreeTest(   tree,   low = \"grey90\",   mid = \"red\",   high = \"darkred\",   xmax.scale = 1.5 )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTest.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot tree with results from multivariate testing — plotTreeTest","text":"tree phylo object storing tree low low color gradient mid mid color gradient high high color gradient xmax.scale expand x-axis factor leaf labels fit plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTest.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot tree with results from multivariate testing — plotTreeTest","text":"","code":"library(variancePartition)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Apply crumblr transformation cobj <- crumblr(df_cellCounts)  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Perform multivariate test across the hierarchy res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot hierarchy and testing results plotTreeTest(res)   # Extract results for first 3 nodes res[1:3, ] #> # A tibble: 3 × 9 #>    node    beta     se  stat pvalue n_features lambda method          FDR #>   <int>   <dbl>  <dbl> <dbl>  <dbl>      <dbl>  <dbl> <chr>         <dbl> #> 1     1 -0.105  0.0348 -3.01 0.0137          1   0.01 FE.empirical 0.0513 #> 2     2 -0.105  0.0337 -3.12 0.0114          1   0.01 FE.empirical 0.0513 #> 3     3 -0.0784 0.0351 -2.23 0.0509          1   0.01 FE.empirical 0.109"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTestBeta.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot tree coefficients from multivariate testing — plotTreeTestBeta","title":"Plot tree coefficients from multivariate testing — plotTreeTestBeta","text":"Plot tree coefficients multivariate testing node.  applicable top fixed effect tests","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTestBeta.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot tree coefficients from multivariate testing — plotTreeTestBeta","text":"","code":"plotTreeTestBeta(   tree,   low = \"blue\",   mid = \"white\",   high = \"red\",   xmax.scale = 1.5 )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTestBeta.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot tree coefficients from multivariate testing — plotTreeTestBeta","text":"tree phylo object storing tree low low color gradient mid mid color gradient high high color gradient xmax.scale expand x-axis factor leaf labels fit plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/plotTreeTestBeta.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot tree coefficients from multivariate testing — plotTreeTestBeta","text":"","code":"library(variancePartition)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Apply crumblr transformation cobj <- crumblr(df_cellCounts)  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Perform multivariate test across the hierarchy res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot hierarchy, no tests are significant  plotTreeTestBeta(res)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Standardize observations using precision weights — standardize","title":"Standardize observations using precision weights — standardize","text":"Compute standardized observations dividing observed values standard deviations based precision weights","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Standardize observations using precision weights — standardize","text":"","code":"standardize(x, ...)  # S4 method for class 'EList' standardize(x, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Standardize observations using precision weights — standardize","text":"x object storing data transformed ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Standardize observations using precision weights — standardize","text":"matrix standardized values","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Standardize observations using precision weights — standardize","text":"Weighted response standard deviation resulting values approximately equal sample variance. key property improves downstream PCA clustering analysis.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/standardize-method.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Standardize observations using precision weights — standardize","text":"","code":"# set probability of each category prob <- c(0.1, 0.2, 0.3, 0.5)  # number of total counts countsTotal <- 300  # number of samples n_samples <- 100  # simulate counts from multinomial counts <- t(rmultinom(n_samples, size = countsTotal, prob = prob)) colnames(counts) <- paste0(\"cat_\", 1:length(prob)) rownames(counts) <- paste0(\"sample_\", 1:n_samples)  # run crumblr on counts cobj <- crumblr(counts)  # Standardize crumblr responses df_std <- standardize(cobj)  # Perform PCA on student transformed data pca <- prcomp(t(df_std)) df_pca <- as.data.frame(pca$x)  ggplot(df_pca, aes(PC1, PC2)) +   geom_point() +   theme_classic() +   theme(aspect.ratio = 1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Studentize observations using precision weights — studentize","title":"Studentize observations using precision weights — studentize","text":"Compute studentized observations precision weights scaling observation respective standard error","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Studentize observations using precision weights — studentize","text":"","code":"studentize(x)  # S4 method for EList studentize(x)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Studentize observations using precision weights — studentize","text":"x object storing data transformed","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Studentize observations using precision weights — studentize","text":"matrix studentized values","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Studentize observations using precision weights — studentize","text":"Student transform scales observed value standard error.  x$weight stores inverse variance observation.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/studentize-method.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Studentize observations using precision weights — studentize","text":"","code":"# set probability of each category prob <- c(0.1, 0.2, 0.3, 0.5)  # number of total counts countsTotal <- 300  # number of samples n_samples <- 100  # simulate counts from multinomial counts <- t(rmultinom(n_samples, size = countsTotal, prob = prob)) colnames(counts) <- paste0(\"cat_\", 1:length(prob)) rownames(counts) <- paste0(\"sample_\", 1:n_samples)  # run crumblr on counts cobj <- crumblr(counts)  # apply student transform df_student <- studentize(cobj)  # Perform PCA on student transformed data pca <- prcomp(t(df_student)) df_pca <- as.data.frame(pca$x)  ggplot(df_pca, aes(PC1, PC2)) +   geom_point() +   theme_classic() +   theme(aspect.ratio = 1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/treeTest.html","id":null,"dir":"Reference","previous_headings":"","what":"Perform multivariate testing along a hierarchy — treeTest","title":"Perform multivariate testing along a hierarchy — treeTest","text":"Perform multivariate testing using mvTest() along nodes tree","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/treeTest.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Perform multivariate testing along a hierarchy — treeTest","text":"","code":"treeTest(   fit,   obj,   hc,   coef,   method = c(\"FE.empirical\", \"FE\", \"RE2C\", \"tstat\", \"sidak\", \"fisher\"),   shrink.cov = TRUE )"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/treeTest.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Perform multivariate testing along a hierarchy — treeTest","text":"fit MArrayLM object return lmFit() dream() obj EList object returned voom() hc hierarchical clustering hclust object coef name coefficient extracted method statistical method used perform multivariate test.  See details.  'FE' fixed effect test models covariance coefficients. 'FE.empirical' use compute empirical p-values sampling null distribution fitting gamma. 'RE2C' random effect test heterogeneity estimated coefficients models covariance coefficients, also incorporates fixed effects test . 'tstat' combines t-statistics models covariance coefficients. 'sidak' returns smallest p-value accounting number tests. 'fisher' combines p-value using Fisher's method assuming independent tests. shrink.cov shrink covariance matrix coefficients using Schafer-Strimmer method","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/treeTest.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Perform multivariate testing along a hierarchy — treeTest","text":"See package remaCor details remaCor::RE2C() test, see remaCor::LS() details fixed effect test.  1 feature selected, original t-statistic p-value returned.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/treeTest.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Perform multivariate testing along a hierarchy — treeTest","text":"","code":"library(variancePartition)  # Load cell counts, clustering and metadata # from Kang, et al. (2018) https://doi.org/10.1038/nbt.4042 data(IFNCellCounts)  # Apply crumblr transformation cobj <- crumblr(df_cellCounts)  # Use dream workflow to analyze each cell separately fit <- dream(cobj, ~ StimStatus + ind, info) fit <- eBayes(fit)  # Perform multivariate test across the hierarchy res <- treeTest(fit, cobj, hcl, coef = \"StimStatusstim\")  # Plot hierarchy and testing results plotTreeTest(res)   # Extract results for first 3 nodes res[1:3, ] #> # A tibble: 3 × 9 #>    node    beta     se  stat pvalue n_features lambda method          FDR #>   <int>   <dbl>  <dbl> <dbl>  <dbl>      <dbl>  <dbl> <chr>         <dbl> #> 1     1 -0.105  0.0348 -3.01 0.0137          1   0.01 FE.empirical 0.0513 #> 2     2 -0.105  0.0337 -3.12 0.0114          1   0.01 FE.empirical 0.0513 #> 3     3 -0.0784 0.0351 -2.23 0.0509          1   0.01 FE.empirical 0.109"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Variance stabilizing transform from precision weights — vst","title":"Variance stabilizing transform from precision weights — vst","text":"Compute variance stabilizing transform (VST) precision weights scaling observation respective weights","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Variance stabilizing transform from precision weights — vst","text":"","code":"vst(x)  # S4 method for EList vst(x)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Variance stabilizing transform from precision weights — vst","text":"x object storing data transformed","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Variance stabilizing transform from precision weights — vst","text":"matrix variance stabilized values","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Variance stabilizing transform from precision weights — vst","text":"variance stabilizing transform usually described terms parametric model observed data.  Instead, inverse variance observation stored x$weight VST divides observed data scaled standard deviations","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/reference/vst-method.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Variance stabilizing transform from precision weights — vst","text":"","code":"# set probability of each category prob = c(0.1, 0.2, 0.3, 0.5)  # number of total counts countsTotal = 300  # number of samples n_samples = 100  # simulate counts from multinomial counts = t(rmultinom(n_samples, size = countsTotal, prob = prob)) colnames(counts) = paste0(\"cat_\", 1:length(prob)) rownames(counts) = paste0(\"sample_\", 1:n_samples)  # run crumblr on counts cobj = crumblr(counts)  # apply variance stabilizing transform (vst) df_vst = vst(cobj)  # Perform PCA on VST transformed data pca = prcomp(t(df_vst)) df_pca = as.data.frame(pca$x)  ggplot(df_pca, aes(PC1, PC2)) + geom_point() + theme_classic() + theme(aspect.ratio=1)"},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-09913","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.13","title":"crumblr 0.99.13","text":"Jan 14, 2025 Bioc submission","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-09911","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.11","title":"crumblr 0.99.11","text":"June 14, 2024 improve documentation add plotForest() add standardize()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-09910","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.10","title":"crumblr 0.99.10","text":"June 12, 2024 add diffTree() plotTreeTestBeta() regularize weight estimates","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0999","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.9","title":"crumblr 0.99.9","text":"Feb 1, 2024 add crumblr(..,method=method) method %% c(\"clr\", \"clr_2class\")","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0998","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.8","title":"crumblr 0.99.8","text":"May 12, 2023 treeTest() add argument shrink.cov = TRUE. give slightly different p-values, protects false positives number features get large compared sample size","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0997","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.7","title":"crumblr 0.99.7","text":"April 5, 2023 fix plotting bug plotTreeTest()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0996","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.6","title":"crumblr 0.99.6","text":"Dec 7, 2022 update docs, add vignette, dependencies","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0995","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.5","title":"crumblr 0.99.5","text":"Nov 29, 2022 bug fix update docs","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0994","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.4","title":"crumblr 0.99.4","text":"enforce variancePartition version dependency","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0993","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.3","title":"crumblr 0.99.3","text":"buildClusterTree() uses cosine distance default treeTest() now uses method=\"treeTest\" default","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0992","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.2","title":"crumblr 0.99.2","text":"update plotTreeTest() Use variancePartition dependency GitHub","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0991","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.1","title":"crumblr 0.99.1","text":"add functions perform mvTest() trees","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-0990","dir":"Changelog","previous_headings":"","what":"crumblr 0.99.0","title":"crumblr 0.99.0","text":"Jun 24, 2022 Fix version number compatibility Bioconductor","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-107","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.7","title":"crumblr 1.0.7","text":"Feb 1, 2022 fix vst() add plots plotScatterDensity() meanSdPlot() VST add vignette vst.Rmd","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-106","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.6","title":"crumblr 1.0.6","text":"Jan 31, 2022 add logo, example data","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-105","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.5","title":"crumblr 1.0.5","text":"Dec 27, 2021 add dmn.mle() use generic crumblr() function","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-104","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.4","title":"crumblr 1.0.4","text":"Dec 23, 2021 Update vignette export clr()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-103","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.3","title":"crumblr 1.0.3","text":"Dec 20, 2021 fix vst bug","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-102","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.2","title":"crumblr 1.0.2","text":"Dec 20, 2021 add vst","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-101","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.1","title":"crumblr 1.0.1","text":"Oct 29, 2021 handle data.frame","code":""},{"path":"http://DiseaseNeurogenomics.github.io/crumblr/news/index.html","id":"crumblr-100","dir":"Changelog","previous_headings":"","what":"crumblr 1.0.0","title":"crumblr 1.0.0","text":"Oct 28, 2021 Initial version","code":""}]
